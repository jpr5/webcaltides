<%
    # Extract common values
    uri = URI.parse(request.url)
    scheme = uri.scheme
    current_units = defined?(units) && units ? units : 'imperial'
    depth_unit = current_units == 'metric' ? 'm' : 'ft'
    distance_unit = current_units == 'metric' ? 'km' : 'mi'
%>

<!-- Search Form -->
<form action="/" accept-charset="UTF-8" method="POST" class="w-full max-w-2xl mx-auto">
    <div class="search-wrapper relative">
        <!-- Main search input -->
        <div class="relative flex items-center">
            <!-- Compass icon -->
            <div class="absolute left-4 pointer-events-none">
                <svg class="compass-icon w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                          d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                          d="M14.5 9.5l-5 2 2 5 5-2-2-5z"/>
                </svg>
            </div>

            <input
                type="text"
                name="searchtext"
                id="searchtext"
                class="search-input w-full pl-12 pr-28 py-4 md:py-5 bg-navy-800/80 border border-navy-700/50 rounded-2xl text-white placeholder-slate-500 text-lg focus:outline-none focus:border-ocean-500/50"
                placeholder="<%= defined?(placeholder) && placeholder != 'Station...' ? placeholder : 'Try \"Alcatraz Island\" or \"37.8, -122.4\"' %>"
                value=""
                autocomplete="off"
            />

            <!-- Units toggle -->
            <div class="absolute right-20 flex items-center">
                <select
                    name="units"
                    id="searchunits"
                    class="bg-transparent border-none text-sm text-slate-400 focus:outline-none focus:ring-0 cursor-pointer hover:text-slate-300 transition-colors"
                >
                    <option value="imperial" <%= 'selected' if current_units == 'imperial' %> class="bg-navy-800">ft/mi</option>
                    <option value="metric" <%= 'selected' if current_units == 'metric' %> class="bg-navy-800">m/km</option>
                </select>
            </div>

            <!-- Search button -->
            <button
                type="submit"
                class="absolute right-2 px-4 py-2 md:py-2.5 bg-ocean-500 hover:bg-ocean-400 text-white font-medium rounded-xl transition-all duration-200 btn-primary"
            >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
            </button>
        </div>

        <!-- GPS format hint -->
        <p class="text-center text-slate-600 text-xs mt-3">
            GPS: decimal <code class="text-slate-500">37.8, -122.4</code> or degrees <code class="text-slate-500">37¬∞48'N 122¬∞24'W</code>
        </p>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var search = document.getElementById('searchtext');
    if (search) {
        search.focus();

        // Retain prior search value with Ctrl+E or Right Arrow
        search.addEventListener('keydown', function(e) {
            if ((e.ctrlKey && e.key === 'e') || e.key === 'ArrowRight') {
                if ((this.selectionStart === 0 && this.selectionEnd === 0 && !this.value) ||
                    (e.key === 'ArrowRight' && this.selectionStart === 0 && this.selectionEnd === 0)) {
                    e.preventDefault();
                    if (this.placeholder && !this.placeholder.startsWith('Try')) {
                        this.value = this.placeholder;
                        this.selectionStart = this.selectionEnd = this.value.length;
                    }
                }
            }
        });
    }
});
</script>

<% if defined?(tide_results) && defined?(current_results) %>
</div></header>

<!-- Results Section -->
<main class="bg-navy-950 py-12 md:py-16">
    <div class="max-w-6xl mx-auto px-4">

        <!-- Search summary -->
        <div class="text-center mb-10 animate-fade-up">
            <p class="text-slate-400">
                <% case how
                   when 'by' %>
                    Showing results for "<span class="text-white font-medium"><%= tokens.join(" ") %></span>"
                <% when 'near' %>
                    Stations near <span class="text-white font-medium"><%= tokens.join(", ") %></span>
                <% end %>
                <% if radius && radius > 0 %>
                    within <span class="text-ocean-400"><%= radius %><%= distance_unit %></span>
                <% end %>
                <span class="text-slate-600">¬∑</span>
                <span class="text-slate-500"><%= tide_results.count + current_results.count %> found</span>
            </p>
        </div>

        <% if tide_results.count > 0 %>
        <!-- Tide Stations Section -->
        <section class="mb-16 animate-fade-up animation-delay-100">
            <div class="flex items-center gap-3 mb-6">
                <div class="flex items-center justify-center w-10 h-10 rounded-full bg-ocean-500/10 border border-ocean-500/20">
                    <svg class="w-5 h-5 text-ocean-400" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17.66 8L12 2.35 6.34 8A8.02 8.02 0 004 13.64c0 2 .78 4.11 2.34 5.67a7.99 7.99 0 0011.32 0c1.56-1.56 2.34-3.67 2.34-5.67 0-2.15-.86-4.2-2.34-5.64zM6 14c.01-2 .62-3.27 1.76-4.4L12 5.27l4.24 4.38C17.38 10.77 17.99 12 18 14H6z"/>
                    </svg>
                </div>
                <h2 class="font-display text-2xl md:text-3xl font-semibold text-white">Tide Stations</h2>
                <span class="text-slate-500 text-sm">(<%= tide_results.count %>)</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                <% tide_results.each_with_index do |r, index| %>
                <%
                    uri.path = "/tides/#{r.id}.ics"
                    uri.query = "units=#{current_units}"
                    uri.scheme = "webcal"
                    webcal_url = uri.to_s
                    uri.scheme = scheme
                    https_url = uri.to_s
                    card_id = "tide_#{r.id}"
                %>
                <div class="station-card bg-navy-800/50 border border-navy-700/50 rounded-2xl overflow-hidden backdrop-blur-sm"
                     x-data="{ solar: true, lunar: false }"
                     style="animation-delay: <%= index * 50 %>ms">

                    <!-- Card Header -->
                    <div class="p-4 md:p-5">
                        <div class="flex items-start justify-between gap-3 mb-3">
                            <div class="flex-1 min-w-0">
                                <h3 class="font-display text-lg md:text-xl font-semibold text-white truncate" title="<%= r.name %>">
                                    <%= r.name %>
                                </h3>
                                <p class="text-slate-500 text-sm truncate"><%= r.region %></p>
                            </div>

                            <!-- Provider badge -->
                            <% if r.provider.in?(['xtide', 'ticon']) %>
                            <div x-data="{ showTip: false }" class="relative flex-shrink-0">
                                <span
                                    @mouseenter="showTip = true"
                                    @mouseleave="showTip = false"
                                    @click="showTip = !showTip"
                                    class="badge-warning inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-amber-500/20 text-amber-400 border border-amber-500/30 cursor-help"
                                >
                                    <%= r.provider == 'ticon' ? 'TICON' : 'XTide' %>
                                </span>
                                <div
                                    x-show="showTip"
                                    x-cloak
                                    x-transition
                                    class="absolute top-full right-0 mt-2 w-64 p-3 bg-navy-900 border border-amber-500/30 rounded-lg shadow-xl z-50 text-xs"
                                >
                                    <p class="font-bold text-amber-400 mb-1">NOT FOR NAVIGATION</p>
                                    <p class="text-slate-400 leading-relaxed">Based on harmonic constants, not official measurements. Distributed WITHOUT ANY WARRANTY.</p>
                                </div>
                            </div>
                            <% elsif r.provider == 'noaa' %>
                            <span class="inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-emerald-500/20 text-emerald-400 border border-emerald-500/30">
                                NOAA
                            </span>
                            <% elsif r.provider == 'chs' %>
                            <span class="inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-emerald-500/20 text-emerald-400 border border-emerald-500/30">
                                CHS
                            </span>
                            <% end %>
                        </div>

                        <!-- Station ID (clickable for official sources) -->
                        <% if r.provider.in?(['xtide', 'ticon']) %>
                        <p class="text-slate-600 text-xs font-mono"><%= r.public_id %></p>
                        <% else %>
                        <a href="<%= r.url %>" target="_blank" class="text-ocean-400/70 hover:text-ocean-400 text-xs font-mono transition-colors">
                            <%= r.public_id %> ‚Üó
                        </a>
                        <% end %>
                    </div>

                    <!-- Divider -->
                    <div class="border-t border-navy-700/50"></div>

                    <!-- Options & Actions -->
                    <div class="p-4 md:p-5">
                        <!-- Toggle options -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-4">
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <div
                                        class="toggle-switch"
                                        :class="{ 'active': solar }"
                                        @click="solar = !solar"
                                    ></div>
                                    <span class="text-sm text-slate-400 group-hover:text-slate-300 transition-colors">
                                        <span class="hidden sm:inline">‚òÄÔ∏é</span> Solar
                                    </span>
                                </label>

                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <div
                                        class="toggle-switch"
                                        :class="{ 'active': lunar }"
                                        @click="lunar = !lunar"
                                    ></div>
                                    <span class="text-sm text-slate-400 group-hover:text-slate-300 transition-colors">
                                        <span class="hidden sm:inline">‚òæ</span> Lunar
                                    </span>
                                </label>
                            </div>
                        </div>

                        <!-- Action buttons -->
                        <div class="flex items-center gap-2">
                            <button
                                @click="navigator.clipboard.writeText('<%= webcal_url %>' + (!solar ? '&solar=0' : '') + (lunar ? '&lunar=1' : ''))"
                                class="flex-1 flex items-center justify-center gap-2 px-3 py-2.5 bg-navy-700/50 hover:bg-navy-700 border border-navy-600/50 rounded-xl text-sm text-slate-300 transition-all duration-200"
                                title="Copy webcal URL"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                                <span class="hidden sm:inline">Copy</span>
                            </button>

                            <a
                                :href="'<%= https_url %>' + (!solar ? '&solar=0' : '') + (lunar ? '&lunar=1' : '')"
                                target="_blank"
                                class="flex-1 flex items-center justify-center gap-2 px-3 py-2.5 bg-navy-700/50 hover:bg-navy-700 border border-navy-600/50 rounded-xl text-sm text-slate-300 transition-all duration-200"
                                title="Download .ics file"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                </svg>
                                <span class="hidden sm:inline">Download</span>
                            </a>

                            <a
                                :href="'<%= webcal_url %>' + (!solar ? '&solar=0' : '') + (lunar ? '&lunar=1' : '')"
                                class="flex-[1.5] flex items-center justify-center gap-2 px-4 py-2.5 bg-ocean-500 hover:bg-ocean-400 rounded-xl text-sm text-white font-medium transition-all duration-200 btn-primary"
                                title="Subscribe in your calendar app"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                Subscribe
                            </a>
                        </div>

                        <!-- Find nearby link -->
                        <div x-data="{ showNearby: false }" class="mt-3 relative">
                            <button
                                @click="showNearby = !showNearby"
                                class="text-xs text-slate-500 hover:text-ocean-400 transition-colors"
                            >
                                Find nearby stations ‚Üí
                            </button>

                            <div
                                x-show="showNearby"
                                x-cloak
                                @click.away="showNearby = false"
                                x-transition
                                class="absolute left-0 bottom-full mb-2 p-3 bg-navy-900 border border-navy-700 rounded-xl shadow-xl z-50"
                            >
                                <form action="/" method="POST" class="flex items-center gap-2">
                                    <input type="hidden" name="searchtext" value="<%= r.id %>" />
                                    <input type="hidden" name="units" value="<%= current_units %>" />
                                    <input
                                        type="number"
                                        name="within"
                                        placeholder="10"
                                        class="w-16 px-2 py-1.5 bg-navy-800 border border-navy-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-ocean-500"
                                    />
                                    <span class="text-slate-500 text-sm"><%= distance_unit %></span>
                                    <button
                                        type="submit"
                                        class="px-3 py-1.5 bg-ocean-500 hover:bg-ocean-400 rounded-lg text-sm text-white transition-colors"
                                    >
                                        Search
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <% end %>
            </div>
        </section>
        <% end %>

        <% if current_results.count > 0 %>
        <!-- Current Stations Section -->
        <section class="animate-fade-up animation-delay-200">
            <div class="flex items-center gap-3 mb-6">
                <div class="flex items-center justify-center w-10 h-10 rounded-full bg-seafoam-500/10 border border-seafoam-500/20">
                    <svg class="w-5 h-5 text-seafoam-400" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                    </svg>
                </div>
                <h2 class="font-display text-2xl md:text-3xl font-semibold text-white">Current Stations</h2>
                <span class="text-slate-500 text-sm">(<%= current_results.count %>)</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                <% current_results.each_with_index do |r, index| %>
                <%
                    uri.path = "/currents/#{r.bid}.ics"
                    uri.query = "units=#{current_units}"
                    uri.scheme = "webcal"
                    webcal_url = uri.to_s
                    uri.scheme = scheme
                    https_url = uri.to_s
                    card_id = "current_#{r.bid}"
                %>
                <div class="station-card bg-navy-800/50 border border-navy-700/50 rounded-2xl overflow-hidden backdrop-blur-sm"
                     x-data="{ solar: true, lunar: false }"
                     style="animation-delay: <%= index * 50 %>ms">

                    <!-- Card Header -->
                    <div class="p-4 md:p-5">
                        <div class="flex items-start justify-between gap-3 mb-3">
                            <div class="flex-1 min-w-0">
                                <h3 class="font-display text-lg md:text-xl font-semibold text-white truncate" title="<%= r.name %>">
                                    <%= r.name %>
                                </h3>
                                <p class="text-slate-500 text-sm truncate"><%= r.region %></p>
                            </div>

                            <!-- Provider badge -->
                            <% if r.provider.in?(['xtide', 'ticon']) %>
                            <div x-data="{ showTip: false }" class="relative flex-shrink-0">
                                <span
                                    @mouseenter="showTip = true"
                                    @mouseleave="showTip = false"
                                    @click="showTip = !showTip"
                                    class="badge-warning inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-amber-500/20 text-amber-400 border border-amber-500/30 cursor-help"
                                >
                                    <%= r.provider == 'ticon' ? 'TICON' : 'XTide' %>
                                </span>
                                <div
                                    x-show="showTip"
                                    x-cloak
                                    x-transition
                                    class="absolute top-full right-0 mt-2 w-64 p-3 bg-navy-900 border border-amber-500/30 rounded-lg shadow-xl z-50 text-xs"
                                >
                                    <p class="font-bold text-amber-400 mb-1">NOT FOR NAVIGATION</p>
                                    <p class="text-slate-400 leading-relaxed">Based on harmonic constants, not official measurements. Distributed WITHOUT ANY WARRANTY.</p>
                                </div>
                            </div>
                            <% elsif r.provider == 'noaa' %>
                            <span class="inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-emerald-500/20 text-emerald-400 border border-emerald-500/30">
                                NOAA
                            </span>
                            <% elsif r.provider == 'chs' %>
                            <span class="inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-emerald-500/20 text-emerald-400 border border-emerald-500/30">
                                CHS
                            </span>
                            <% end %>
                        </div>

                        <!-- Depth indicator -->
                        <div class="flex items-center gap-2 mb-2">
                            <span class="inline-flex items-center px-2 py-0.5 rounded bg-navy-700/50 text-xs text-slate-400">
                                üìç Depth: <%= r.depth.to_i %><%= depth_unit %>
                            </span>
                        </div>

                        <!-- Station ID (clickable for official sources) -->
                        <% if r.provider.in?(['xtide', 'ticon']) %>
                        <p class="text-slate-600 text-xs font-mono"><%= r.bid || r.id %></p>
                        <% else %>
                        <a href="<%= r.url %>" target="_blank" class="text-ocean-400/70 hover:text-ocean-400 text-xs font-mono transition-colors">
                            <%= r.bid || r.id %> ‚Üó
                        </a>
                        <% end %>
                    </div>

                    <!-- Divider -->
                    <div class="border-t border-navy-700/50"></div>

                    <!-- Options & Actions -->
                    <div class="p-4 md:p-5">
                        <!-- Toggle options -->
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-4">
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <div
                                        class="toggle-switch"
                                        :class="{ 'active': solar }"
                                        @click="solar = !solar"
                                    ></div>
                                    <span class="text-sm text-slate-400 group-hover:text-slate-300 transition-colors">
                                        <span class="hidden sm:inline">‚òÄÔ∏é</span> Solar
                                    </span>
                                </label>

                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <div
                                        class="toggle-switch"
                                        :class="{ 'active': lunar }"
                                        @click="lunar = !lunar"
                                    ></div>
                                    <span class="text-sm text-slate-400 group-hover:text-slate-300 transition-colors">
                                        <span class="hidden sm:inline">‚òæ</span> Lunar
                                    </span>
                                </label>
                            </div>
                        </div>

                        <!-- Action buttons -->
                        <div class="flex items-center gap-2">
                            <button
                                @click="navigator.clipboard.writeText('<%= webcal_url %>' + (!solar ? '&solar=0' : '') + (lunar ? '&lunar=1' : ''))"
                                class="flex-1 flex items-center justify-center gap-2 px-3 py-2.5 bg-navy-700/50 hover:bg-navy-700 border border-navy-600/50 rounded-xl text-sm text-slate-300 transition-all duration-200"
                                title="Copy webcal URL"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                </svg>
                                <span class="hidden sm:inline">Copy</span>
                            </button>

                            <a
                                :href="'<%= https_url %>' + (!solar ? '&solar=0' : '') + (lunar ? '&lunar=1' : '')"
                                target="_blank"
                                class="flex-1 flex items-center justify-center gap-2 px-3 py-2.5 bg-navy-700/50 hover:bg-navy-700 border border-navy-600/50 rounded-xl text-sm text-slate-300 transition-all duration-200"
                                title="Download .ics file"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                                </svg>
                                <span class="hidden sm:inline">Download</span>
                            </a>

                            <a
                                :href="'<%= webcal_url %>' + (!solar ? '&solar=0' : '') + (lunar ? '&lunar=1' : '')"
                                class="flex-[1.5] flex items-center justify-center gap-2 px-4 py-2.5 bg-seafoam-500 hover:bg-seafoam-400 rounded-xl text-sm text-navy-900 font-medium transition-all duration-200 btn-primary"
                                title="Subscribe in your calendar app"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                                Subscribe
                            </a>
                        </div>

                        <!-- Find nearby link -->
                        <div x-data="{ showNearby: false }" class="mt-3 relative">
                            <button
                                @click="showNearby = !showNearby"
                                class="text-xs text-slate-500 hover:text-seafoam-400 transition-colors"
                            >
                                Find nearby stations ‚Üí
                            </button>

                            <div
                                x-show="showNearby"
                                x-cloak
                                @click.away="showNearby = false"
                                x-transition
                                class="absolute left-0 bottom-full mb-2 p-3 bg-navy-900 border border-navy-700 rounded-xl shadow-xl z-50"
                            >
                                <form action="/" method="POST" class="flex items-center gap-2">
                                    <input type="hidden" name="searchtext" value="<%= r.id %>" />
                                    <input type="hidden" name="units" value="<%= current_units %>" />
                                    <input
                                        type="number"
                                        name="within"
                                        placeholder="10"
                                        class="w-16 px-2 py-1.5 bg-navy-800 border border-navy-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-seafoam-500"
                                    />
                                    <span class="text-slate-500 text-sm"><%= distance_unit %></span>
                                    <button
                                        type="submit"
                                        class="px-3 py-1.5 bg-seafoam-500 hover:bg-seafoam-400 rounded-lg text-sm text-navy-900 transition-colors"
                                    >
                                        Search
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <% end %>
            </div>
        </section>
        <% end %>

        <% if tide_results.count == 0 && current_results.count == 0 %>
        <!-- No results -->
        <div class="text-center py-16 animate-fade-up">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-navy-800/50 mb-4">
                <svg class="w-8 h-8 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
            </div>
            <h3 class="font-display text-xl text-slate-400 mb-2">No stations found</h3>
            <p class="text-slate-500">Try a different search term or GPS coordinates</p>
        </div>
        <% end %>

    </div>
</main>

<!-- Dummy elements to close the header tags opened in layout -->
<header class="hidden"><div class="hidden">
<% end %>
